# 错误处理

## 运行时错误

- [MDN JavaScript Error](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error)
- [ECMAScript exceptions](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error#error_types)
- [`DOMException`](https://developer.mozilla.org/zh-CN/docs/Web/API/DOMException) and [`DOMError`](https://developer.mozilla.org/zh-CN/docs/Web/API/DOMError)

## 脚本错误

- 编译时错误
- 运行时错误

## 捕获错误

- `try...catch` - 可以捕获堆栈信息，但需要侵入式包裹需要被捕获的代码
- `window.onerror`  - 可以捕获堆栈信息，不需要侵入，但只能捕获运行时

## 脚本跨域问题

尤其是存放在 CDN 上的脚本，由于同源策略，如果报错无法捕获详细信息

**解决方案**

- 在 `script` 标签添加 `crossorigin` 属性（推荐打包工具添加）
- 服务器或者 CDN 服务器设置 `Acess-Control-Origin:*`

## 资源加载错误

获取没有被加载成功的图片：

- 通过 `document.getElementsByTagName('image')` 获取所有标签元素
- 通过 `performance.getEntries().filter(i=>i.initiatorType === 'img')` 获取所有已加载的图片

```jsx
const allImgs = document.getElementsByTagName('image')
const loadedImgs = performance.getEntries().filter(i => i.initiatorType === 'img')
```

## Promise 错误

```jsx
window.ad unhandledrejection
```