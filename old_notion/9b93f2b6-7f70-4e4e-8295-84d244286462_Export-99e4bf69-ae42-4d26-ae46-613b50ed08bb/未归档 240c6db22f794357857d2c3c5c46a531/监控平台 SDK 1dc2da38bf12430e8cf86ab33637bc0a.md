# 监控平台 SDK

## 知名第三方

- 

## 常见错误

- JS 报错
    - SyntaxError
    - TypeError
    - ReferenceError
    - RangeError
- 网络错误
    - ResourceError
    - HttpError

## 错误收集

- try/catch - 收集常见错误？哪些？语法和异步错误不行
- window.onerror
- window.addEventListener
    - unhandledrejection
    - error

## Vue 错误

- **Vue**.config.errorHandler

## React 错误

。。。

## 跨域错误

```bash
export enum EventTypes {
  API = 'api',
  DOM = 'dom',
  PERFORMANCE = 'performance',
  ROUTE = 'route',
  ERROR = 'error',
  CONSOLE = 'console',
  CUSTOMER = 'customer',
  VUE = 'vue',
  LIFECYCLE = 'lifeCycle',
  EXTEND = 'extend',
  RECORD = 'record'
}

export enum BrowserBreadcrumbTypes {
  ROUTE = 'Route',
  CLICK = 'UI.Click',
  CONSOLE = 'Console',
  XHR = 'Xhr',
  FETCH = 'Fetch',
  UNHANDLEDREJECTION = 'Unhandledrejection',
  RESOURCE = 'Resource',
  CODE_ERROR = 'CodeError',
  CUSTOMER = 'Customer',
  FRAMEWORK = 'Framework',
  LIFECYCLE = 'LifeCycle',
  CRASH = 'Crash'
}

```

监控

```bash
window.addEventListener('load',
      window.addEventListener('unload'
       window.addEventListener(
      'error',
      
          window.addEventListener('unhandledrejection',
          
          
          监控面板
```

监控面板

```bash
 monitor(notify: (data: CollectedData) => void) {
      const fpsTool = new FPSTool();
      // fmp
      if (!performancOff.includes(PerformanceFeat.FMP)) {
        const fmpTiming = new FMPTiming();
        fmpTiming.initObserver().then((fmp) => {
          notify({
            sub_type: PerTypes.FMP,
            value: fmp
          });
        });
      }
      // vitals
      if (!performancOff.includes(PerformanceFeat.VITALS)) {
        getVitals().then((vitals) => {
          notify({
            sub_type: PerTypes.VITALS,
            ...vitals
          });
        });
      }
      window.addEventListener(
        'load',
        () => {
          // 基础参数
          if (!performancOff.includes(PerformanceFeat.BASIC)) {
            notify({
              sub_type: PerTypes.BASIC,
              ...getBasic()
            });
          }
          // 资源耗时
          if (!performancOff.includes(PerformanceFeat.RESOURCE)) {
            notify({
              sub_type: PerTypes.RESOURCE,
              value: getResources()
            });
          }
          // fps
          if (!performancOff.includes(PerformanceFeat.FPS)) {
            fpsTool.run();
            setTimeout(() => {
              notify({
                sub_type: PerTypes.FPS,
                value: fpsTool.get()
              });
              fpsTool.destroy();
            }, 500);
          }
        },
        true
      );
    },
```

Vue

```bash
  monitor(notify: (data: VueReportDataType) => void) {
      const { vue: vm } = options;
      const { debug } = this.context;
      if (!vm) {
        this.log('Missing Vue in options');
        return;
      }
      const { errorHandler, silent } = vm.config;
      vm.config.errorHandler = (error: any, vm: ViewModel, lifecycleHook: string) => {
        const { name, message, stack = '' } = error;
        notify({
          name,
          message,
          hook: lifecycleHook,
          stack,
          sub_type: VueTypes.ERROR,
          ...parseStack(stack)
        });
        if (debug) {
          if (typeof errorHandler === 'function') {
            (errorHandler as UnknownFunc).call(this.vm, error, vm, lifecycleHook);
          } else if (!silent) {
            const message = `Error in ${lifecycleHook}: "${stack && stack.toString()}"`;
            this.log(message, ConsoleTypes.ERROR);
          }
        }
      };
    },
```

## 上报

new Image

- **navigator.sendBeacon**
- 图片 src 上报

TODO: 追踪源码

[参考](%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0%20SDK%201dc2da38bf12430e8cf86ab33637bc0a/%E5%8F%82%E8%80%83%20d7bc248cd8964518b3b0c351a8876bb8.md)

[错误处理](%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0%20SDK%201dc2da38bf12430e8cf86ab33637bc0a/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%204eabf7905a3d4688b6b8fe015cfd66e0.md)

[最佳实践](%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0%20SDK%201dc2da38bf12430e8cf86ab33637bc0a/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%209e22f92dde2445a3ba0d0d87283ad272.md)

[埋点](%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0%20SDK%201dc2da38bf12430e8cf86ab33637bc0a/%E5%9F%8B%E7%82%B9%2034481be986624cc1b4f2ce8967021f26.md)