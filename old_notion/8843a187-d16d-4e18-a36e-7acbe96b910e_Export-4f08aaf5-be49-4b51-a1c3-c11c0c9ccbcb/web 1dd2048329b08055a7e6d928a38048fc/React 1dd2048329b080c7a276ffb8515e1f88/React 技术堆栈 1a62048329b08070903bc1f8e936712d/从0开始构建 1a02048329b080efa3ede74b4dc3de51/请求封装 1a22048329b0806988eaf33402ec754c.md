# 请求封装

## 基础

在web开发中，浏览器同样支持很多种传输协议

- HTTP/HTTPS
- WebSocket/WSS
- Server-Sent Events(SSE)
- WebRTC
- WebTransport
- MQTT over WebSocket

使用最多的是 HTTP/HTTPS 协议，web浏览器也给了几种实现

**原生**

- `XMLHttpRequest (XHR)`
- `Fetch API`
- `Beacon API`

第三方工具的支持

- Ajax
- axios

现在用axios的比较多，基本上也都是基于异步处理。

项目封装考虑要点

1. 统一请求管理，避免重复配置
    1. 请求头
    2. 超时设置
    3. 错误处理
    4. 请求拦截
2. 错误处理
    1. 全局错误提示，比如 toast 等
3. 请求状态管理
    1. loading
    2. data
    3. error
4. 封装与复用
5. 缓存和重试
6. 请求取消
7. 并发

## TODO

请求的状态

- loading
- data
- error

三件套如何处理，使用hooks？

1. 调研 react 常见的状态管理
2. 
- [React Query](https://react-query.tanstack.com/)
- [SWR](https://swr.vercel.app/)
- [RTK Query](https://redux-toolkit.js.org/rtk-query/overview)
- tRPC

其他

- **Context API**
- **Redux**
- **Recoil**
- **Zustand**
- **MobX**
- 请求的 ts 规范，按照这个标准来封装，总不会有错吧？https://openapi-ts.dev/openapi-fetch/
- https://orval.dev/guides/custom-axios ？？
- 一个借鉴：https://github.com/infinitered/apisauce/blob/master/lib/apisauce.ts

## SWR