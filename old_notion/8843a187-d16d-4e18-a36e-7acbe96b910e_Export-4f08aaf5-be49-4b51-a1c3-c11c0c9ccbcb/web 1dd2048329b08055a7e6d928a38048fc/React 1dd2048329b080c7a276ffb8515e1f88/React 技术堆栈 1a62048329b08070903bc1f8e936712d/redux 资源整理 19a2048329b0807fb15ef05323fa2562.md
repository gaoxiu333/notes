# redux 资源整理

### 资源整理

- [《Redux 之道，第二部分：实践和哲学》](https://blog.isquaredsoftware.com/2017/05/idiomatic-redux-tao-of-redux-part-2/)。
- **Vanilla Redux （纯净的 Redux学习）**
- [构建你自己的 redux](https://nytimes.github.io/oak-byo-react-prosemirror-redux/post/build-your-own-redux/)
- [mini-redux](https://blog.jakoblind.no/learn-redux-by-coding-a-mini-redux/)
- https://zapier.com/engineering/how-to-build-redux/

### **1. 前置准备：理解核心概念**

- **熟悉 Redux 的核心机制**：
    - `Store`、`Action`、`Reducer`、`Middleware` 的作用和关系。
    - 单向数据流（Action → Reducer → Store → View）。
- **掌握设计原则**：
    - 单一数据源、不可变状态、纯函数 Reducer。
- **熟练使用 Redux**：
    - 至少用 Redux 完成一个完整项目，理解其实际应用场景。

---

### **2. 源码入口：从设计文档开始**

- **阅读 Redux 官方文档的设计思想**：
    - 重点关注 [Prior Art](https://redux.js.org/understanding/thinking-in-redux/glossary#prior-art) 和 [Motivation](https://redux.js.org/understanding/thinking-in-redux/motivation) 部分。
- **查看源码目录结构**：
    - 核心文件：`createStore.js`、`combineReducers.js`、`applyMiddleware.js`。
    - 工具函数：`compose.js`、`bindActionCreators.js`。

### **3. 分模块深入**

### **(1) `createStore` 源码**

- **核心逻辑**：
    - 维护 `state` 和 `listeners`。
    - `dispatch`、`subscribe`、`getState` 的实现。
    - `replaceReducer` 的热替换机制。
- **关键点**：
    - 闭包管理状态，确保不可变性。
    - 观察者模式（发布-订阅）的实现。

```jsx
// 简化版 createStore 核心逻辑
function createStore(reducer, preloadedState) {
  let currentState = preloadedState;
  let listeners = [];

  function getState() {
    return currentState;
  }

  function dispatch(action) {
    currentState = reducer(currentState, action);
    listeners.forEach(listener => listener());
    return action;
  }

  function subscribe(listener) {
    listeners.push(listener);
    return () => {
      listeners = listeners.filter(l => l !== listener);
    };
  }

  // 初始化 state
  dispatch({ type: '@@INIT' });

  return { dispatch, subscribe, getState };
}
```

### **(2) `combineReducers` 源码**

- **核心逻辑**：
    - 合并多个 Reducer，生成一个根 Reducer。
    - 校验 Reducer 的纯净性和意外修改 State。
- **关键点**：
    - 通过 `hasChanged` 标志优化性能。
    - 使用 `assertReducerShape` 检查 Reducer 合法性。

### **(3) `applyMiddleware` 源码**

- **核心逻辑**：
    - 中间件的链式调用（柯里化 + `compose`）。
    - 重写 `dispatch` 方法。
- **关键点**：
    - 中间件的洋葱模型（如 Redux Thunk 的实现）。

```jsx
// 中间件核心逻辑（以 thunk 为例）
const thunk = ({ dispatch, getState }) => next => action => {
  if (typeof action === 'function') {
    return action(dispatch, getState);
  }
  return next(action);
};
```

### **4. 调试与验证**

- **克隆源码并运行测试**：
    
    bash
    
    复制
    
    ```
    git clone https://github.com/reduxjs/redux.git
    cd redux
    npm install
    npm test
    ```
    
- **手动调试**：
    - 在浏览器中用 Debugger 逐行跟踪 `dispatch` 流程。
    - 修改源码并观察测试用例的变化。

---

### **5. 高级进阶**

### **(1) 性能优化设计**

- 理解 `subscribe` 的惰性触发机制。
- `combineReducers` 中的 `hasChanged` 如何避免无效渲染。

### **(2) 函数式编程技巧**

- 高阶函数（HOC）在 `applyMiddleware` 中的应用。
- `compose` 函数的实现（`reduceRight` 的巧妙使用）。

### **(3) 对比其他状态管理库**

- 与 MobX、Zustand 的差异（响应式 vs 单向数据流）。
- Redux Toolkit 如何简化 Redux 使用。

---

### **6. 实践建议**

- **重写简化版 Redux**：
    - 实现 `createStore`、`combineReducers` 核心逻辑（300 行以内）。
- **参与社区贡献**：
    - 从修复文档或简单 Issue 开始，逐步深入。
- **结合 React 源码**：
    - 学习 `react-redux` 的 `Provider` 和 `connect` 实现。

---

### **关键学习点总结**

| **模块** | **核心实现技巧** | **关联设计模式** |
| --- | --- | --- |
| `createStore` | 闭包管理状态、观察者模式 | 发布-订阅模式 |
| `combineReducers` | 函数组合、状态变更检测 | 组合模式 |
| `applyMiddleware` | 高阶函数、函数柯里化 | 责任链模式、洋葱模型 |