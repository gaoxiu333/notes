# cheat sheet

## CLI

帮助

```bash
nest -h
nest g -h
nest g s nombre -h
```

生成

```bash

nest g mo <path/module>   # 创建模块 (module)
nest g co <path/module>   # 创建控制器 (controller)
nest g d <path/module>    # 创建数据传输对象 (DTO)
nest g gu <path/guard>    # 创建守卫 (guard)
nest g in <path/interceptor>   # 创建拦截器 (interceptor)
nest g pi <path/pipes>    # 创建管道 (pipe)
nest g s <path/service>   # 创建服务 (service)
nest g res <path/resource>   # 创建资源 (resource)

# options
 nest g s test --dry-run | -d  
 nest g s test -no-spec

```

## 语法速记

### 请求方法

```tsx
import {Get,Post,Put,Path,Delete}from '@nestjs/common'

@Get()
@Get(':id')
@Get('chats/breed')
@Get(['cats','breed'])
@Get(':producet/:size')

@Params('id')
@Body()
@Query()
@Res()
```

### 类型校验

```bash
pnpm add class-validator class-transformer
```

装饰器

```tsx
IsOptional
IsPositive
...
```

### Nestjs 核心

**Guards**

**功能**: 用于决定是否允许或阻止访问路由。

**实现**: 通过 CanActivate 接口。

**用途**: 实现身份验证或授权逻辑。

**示例**:

```tsx
@Injectable()
export class AuthGuard implements CanActivate {
  canActivate(context: ExecutionContext): boolean {
    // 检查是否有权限访问
    return true; 
  }
}
```

**Controllers**

•	**功能**: 用于处理传入的请求并返回响应。

•	**职责**: 定义应用程序的路由和端点逻辑。

•	**示例**:

```tsx
@Controller('users')
export class UsersController {
  @Get()
  findAll(): string {
    return 'This action returns all users';
  }
}
```

**Providers**

•	**功能**: 用于封装业务逻辑或共享服务。

•	**特性**: 通过依赖注入机制在整个应用中可用。

•	**示例**:

```tsx
@Injectable()
export class UsersService {
  getUsers(): string[] {
    return ['user1', 'user2'];
  }
}
```

**Modules**

•	**功能**: 用于组织应用程序的结构。

•	**职责**: 组合相关的控制器、服务和其他模块。

•	**示例**:

```tsx
@Module({
  imports: [],
  controllers: [UsersController],
  providers: [UsersService],
})
export class UsersModule {}
```

**Middleware**

•	**功能**: 用于在路由处理前修改请求或响应。

•	**用途**: 日志记录、身份验证等。

•	**示例**:

```tsx
@Injectable()
export class LoggerMiddleware implements NestMiddleware {
  use(req: Request, res: Response, next: NextFunction) {
    console.log('Request...');
    next();
  }
}
```

**Pipes**

•	**功能**: 用于转换和验证传入的数据。

•	**实现**: 通过 PipeTransform 接口。

•	**示例**:

```tsx
@Injectable()
export class ValidationPipe implements PipeTransform {
  transform(value: any, metadata: ArgumentMetadata) {
    if (!value) throw new BadRequestException('Validation failed');
    return value;
  }
}
```

**Interceptors**

•	**功能**: 用于拦截方法调用，修改请求或响应。

•	**用途**: 处理日志记录、错误处理、缓存等。

•	**示例**:

```tsx
@Injectable()
export class LoggingInterceptor implements NestInterceptor {
  intercept(context: ExecutionContext, next: CallHandler): Observable<any> {
    console.log('Before...');
    return next.handle().pipe(tap(() => console.log('After...')));
  }
}
```

**Filters (异常过滤器)**:

•	**功能**: 处理未捕获的异常并返回自定义的响应。

•	**示例**:

```tsx
@Catch(HttpException)
export class HttpExceptionFilter implements ExceptionFilter {
  catch(exception: HttpException, host: ArgumentsHost) {
    const ctx = host.switchToHttp();
    const response = ctx.getResponse<Response>();
    const status = exception.getStatus();

    response.status(status).json({
      statusCode: status,
      message: exception.message,
    });
  }
}
```

## 其他

**CORS**

[link](https://docs.nestjs.com/security/cors)

```tsx
const app = await NestFactory.create(AppModule, { cors: true });
// or
const app = await NestFactory.create(AppModule);
app.enableCors();
```