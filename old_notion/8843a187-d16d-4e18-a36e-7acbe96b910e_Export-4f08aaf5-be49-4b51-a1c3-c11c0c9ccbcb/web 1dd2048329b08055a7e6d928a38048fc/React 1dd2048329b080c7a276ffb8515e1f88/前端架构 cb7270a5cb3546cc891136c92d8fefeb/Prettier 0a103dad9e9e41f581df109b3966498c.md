# Prettier

# **Prettier**

# **prettier 入门**

Prettier 是一个固执己见的代码格式化程序，支持：

- JavaScript(包括试验性功能)
- JSX
- TypeScript
- CSS、Less、SCSS
- HTML
- JSON
- Markdown
- YAML

## **疑问？**

### **import**

- Prettier 可以将长`import`语句分成几行：
- 但是配置在哪儿？

### **JSX**

- [替代格式使编辑 JSX 变得更加容易](https://github.com/prettier/prettier/issues/2208)
- 就是很容易留下`;`的问题

## **安装**

```bash
pnpm add --save-dev --save-exact prettier
echo {}> .prettierrc.json
touch .prettierignore# 将基于 .gitignore .eslintignore
npx prettier . --write# 格式化所有内容 文件为 glob 语法
```

## **配置文件**

- [.prettierignore](https://prettier.io/docs/en/ignore)

## **忽略语法**

```jsx
// prettier-ignore 单行忽略// 忽略属性
<!-- prettier-ignore-attribute -->
<!-- prettier-ignore-attribute (mouseup) -->

```

## **命令行**

- `-write` - 格式化文件
- `-check` - 仅检查
- `-config`指定配置文件

```
# 格式化所有内容
npx prettier . --write

# 仅检查文件是否已格式化
npx prettier . --check

```

## **配置**

- JS
    - `experimentalTernaries` - 三元运算格式
    - `printWidth`
    - `tabWidth`
    - `useTabs`
    - `semi` - 分号
    - `singleQuote` - 单引号
    - `quoteProps` - 对象的键是否加引号
    - `trailingComma` - 尾随逗号
    - `bracketSpacing` - `{}`和属性之间的空格
    - `arrowParens`箭头函数的括号：`(x) => x`
    - `rangeStart` - 格式化文件从哪一行考试
    - `rangeEnd` - 同上
    - `endOfLine` - 行为换行符
- JSX
    - `jsxSingleQuote`
- HTML
    - `bracketSameLine` - `>` 放在哪里？
    - `singleAttributePerLine` - HTML属性如何格式化
    - `htmlWhitespaceSensitivity` - HTML中的空白
- Vue
    - `vueIndentScriptAndStyle` - 是否对`script`和`style`首行进行缩进，默认：不
- Markdown
    - `preserve`
    - `embeddedLanguageFormatting` - 是否格式化MD中的代码块

## **特殊规则**

### **多行对象**

- `{`和第一个键是否存在换行符决定
    - 疑问：是不可逆？

## **分号**

- `semi`

分号问题

```jsx
 if (shouldAddLines) {
  +  console.log('Do we even get here??')
   [-1, 1].forEach(delta => addLine(delta * 20))
 }
// 以上代码不加分号很容易造成:if (shouldAddLines) {
  console.log('Do we even get here??')[-1, 1].forEach(delta => addLine(delta * 20))
}

```

### **单行最大宽度问题**

- [printWidth](https://prettier.io/docs/en/options#print-width)

### **HTML行内元素对空白敏感**

- `htmlWhitespaceSensitivity` - 默认尊重元素的默认`display`，行内元素时，对空白表示敏感
    - html 中的 [空白敏感格式。](https://prettier.io/blog/2018/11/07/1.15.0#whitespace-sensitive-formatting)

### **行未换行符号**

历史原因：[可以在维基百科上找到](https://en.wikipedia.org/wiki/Newline)

为什么要这么做？：文本文件中存在两种常见的行结尾形式，尤其是一个项目在Window系统和Mac系统上相互格式化后，很容易出现换行符的问题导致代码出现大量变动。

- `endOfLine`
    - `lf` - 默认使用Linux风格的行为换行格式。
- 如何确保整个`git`存储库都是Linux风格的行为换行格式？
    - Prettier配置:
        1. 确保配置了`endOfLine`
    1. GIt配置:
        1. 添加`text=auto eol=lf`到`.gitattributes`文件。

### **从大型项目逐步开始使用Preetier怎么办？**

- `requirePragma`
- `insertPragma`
- 通过配置：`true`，在需要格式化的文件顶部添加特定注释

```jsx
/**
 * @prettier
 */
```

## 

## **如何自动化运行**

- [编辑器集成](https://prettier.io/docs/en/editors)
- [使用文件观察器运行 Prettier](https://prettier.io/docs/en/watching-files)
- ESlinter
- Git hooks

## **一些重要配置**

max-len、no-mixed-spaces-and-tabs、keywords-spacing

- [max-len](https://eslint.org/docs/rules/max-len) - 强制执行最大行长度
- [no-mixed-spaces-and-tabs](https://eslint.org/docs/rules/no-mixed-spaces-and-tabs) - 禁止混合使用空格和制表符进行缩进
- [keywords-spacing](https://eslint.org/docs/rules/keyword-spacing) - 在关键字前后强制执行一致的间距
- [comma-style](https://eslint.org/docs/latest/rules/comma-style) - 强制使用一致的逗号风格

## **编辑器配置**

## **Linters 集成**

- `eslint-config-prettier` - 最推荐的方式
- `eslint-plugin-prettier` - ???
- Eslint - [eslint-config-prettier](https://github.com/prettier/eslint-config-prettier#installation) 关闭所有不必要或者可能与 Prettier 冲突的 ESlint 规则
- Stylelint - [stylelint-config-prettier](https://github.com/prettier/stylelint-config-prettier) 和上面类似
- ESLint
    - [eslint-config-prettier](https://github.com/prettier/eslint-config-prettier) 关闭可能与 Prettier 冲突的 ESLint 规则
    - [eslint-plugin-prettier](https://github.com/prettier/eslint-plugin-prettier) 将 Prettier 作为 ESLint 规则运行，并报告错误
    - [prettier-eslint](https://github.com/prettier/prettier-eslint) 根据 Prettier 规则进行格式化代码
    - [prettier-standard](https://github.com/sheerun/prettier-standard) 使用 standard 规则格式化代码
- stylelint
    - [stylelint-config-prettier](https://github.com/prettier/stylelint-config-prettier) 关闭可能与 Prettier 冲突的规则
    - [stylelint-prettier](https://github.com/prettier/stylelint-prettier) 将 Prettier 作为 stylelint 规则运行，并报告错误
    - [prettier-stylelint](https://github.com/hugomrdias/prettier-stylelint) 将 Prettier 作为规则，并自动修复
    
    > 参考：相关项目ESLint 和 Prettier 推荐配置
    > 

## **Git hooks**

1. 安装 husky 和 lint-staged
    
    ```bash
    npm install --save-dev husky lint-staged
    npx husky install
    npm pkg set scripts.prepare="husky install"
    npx husky add .husky/pre-commit "npx lint-staged"
    
    ```
    
2. 修改 package.json
    
    ```json
    {
      "lint-staged": {
        "**/*": "prettier --write --ignore-unknown"
      }
    }
    
    ```
    
    > 如果您使用 ESLint，请确保 lint-staged 在 Prettier 之前运行它，而不是之后。参考： 预提交挂钩
    > 

## **忽略代码**

- `.prettierignore` 文件
    
    ```
    # 默认忽略以下文件
    **/.git
    **/.svn
    **/.hg
    **/node_modules # --with-node-modules 参数会启用该文件的格式化
    
    ```
    
- `-ignore-path` CLI 忽略参数
- 注释方式忽略
    
    ```bash
    # js
    // prettier-ignore
    # jsx
    {/* prettier-ignore */}
    # HTML
    <!-- prettier-ignore -->
    <!-- prettier-ignore-attribute -->
    <!-- prettier-ignore-attribute (mouseup) -->
    # CSS
    /* prettier-ignore */
    # Markdown
    <!-- prettier-ignore -->
    
    ```
    
- 更多方式，请参考官网

## **常见问题**

1. `printWidth` 宽度问题
    - `printWidth:Infinity` - 给一无限大的宽度
    - `// prettier-ignore` - 使用注释忽略

---

- https://github.com/prettier/eslint-config-prettier 仅关闭Eslint冲突的规则，需要手动格式化
- https://github.com/prettier/eslint-plugin-prettier 依赖以上关闭规则的配置，并且将格式化集成到 `eslint . --fix`