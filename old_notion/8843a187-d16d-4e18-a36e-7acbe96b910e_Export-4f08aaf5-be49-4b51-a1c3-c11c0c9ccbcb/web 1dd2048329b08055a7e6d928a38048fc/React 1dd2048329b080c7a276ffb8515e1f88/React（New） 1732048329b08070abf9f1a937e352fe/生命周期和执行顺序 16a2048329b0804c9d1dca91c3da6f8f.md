# 生命周期和执行顺序

以下是两份不同重要版本的 React 生命周期可视化演示效果。结合这两份可视化效果加深对React执行顺序的印象。

- [React 16.4 生命周期交互式程序](https://github.com/wojtekmaj/react-lifecycle-methods-diagram?tab=readme-ov-file)
- [React hook 执行顺序](https://julesblom.com/writing/react-hook-component-timeline)

## React Hooks 执行顺序

### 初次渲染阶段

1. 父组件和子组件的 Hook 初始化
    - 按代码顺序依次初始化 useState、useReducer、useRef
    - 计算 useMemo 的值，返回 useCallback 的函数本身
2. DOM 提交（Commit）阶段
    - 先子后父：先插入子组件的 DOM 节点，再插入父组件的DOM节点
    - 设置 ref.current(从子到父)
3. useLayoutEffect 执行
    - 从子到父运行 useLayoutEffect
4. 屏幕绘制（Paint）阶段
    - 浏览器完成所有组件的 DOM 渲染并更新屏幕
5. useEffect 执行
    - 从子到父之行 useEffect

### 更新渲染时执行顺序

1. 清理阶段
    - 先父后子
    - 执行上次渲染的 useEffect 清理函数
    - 执行上次渲染 useLayoutEffect 清理函数
2. 更新 Hook 的值
    - 按代码顺序更新 useState、useReducer、useRef 的值
    - 重新计算 useMemo 和 useCallback（如果依赖发生变化）
3. DOM 提交（Commit）阶段
    - 更新 DOM 节点，重新计算 ref.current(从子到父)
4. useLayoutEffect 执行
    - 从子到父运行useLayoutEffect
5. 屏幕绘制（Paint）阶段
    - 浏览器完成DOM更新并刷新屏幕
6. useEffect 执行
    - 从子到父执行useEffect

## mount ？？

## update？？