# 深入理解 React 渲染

**参考：**[React 渲染行为完整指南（基础）](https://blog.isquaredsoftware.com/2020/05/blogged-answers-a-mostly-complete-guide-to-react-rendering-behavior/#standard-render-behavior)

**PPT：**https://blog.isquaredsoftware.com/presentations/2023-08-guide-react-rendering-behavior/?slideIndex=0&stepIndex=0

**引言**

React思维模型：假装React在每次状态改变时重新渲染所有内容。

`这样思考的话，React优化也就是针对避免重新渲染来进行优化`

## 什么是渲染

React 要求组件根据当前 state 和 porps 的组合来描述他们希望ui看起来像什么过程？？？

## 渲染过程

- **找出标记：**React 将从根组件开始行下递归所有子组件，找出所有标记为需要更新的组件
- 生成 JSX： 调用 方法 保存输出
    - `FunctionComponent(props)` 函数组件
    - `classComponentInstance.render()` 类组件
- 生成虚拟DOM：调用 `React.createElement()` 返回 React elements
- 协调：将新旧DOM进行比较，只更新需要更新的

## 渲染和提交

渲染阶段：包含渲染组件和计算变化的所有工作

提交阶段：将更改应用到 DOM 的过程

提交阶段之后： `componentDidMount` → `componentDidUpdate` → `useLayoutEffect`

最后进入被动效应阶段

被动效应：短超时，之后调用 `useEffect`

并发渲染： `useTransition`

## 触发渲染

Function components

- useState 的 setters
- useReducer 的 dispatches

Class components 

- this.setState
- this.forceUpdate

其他

- 调用 ReactDOM top-level 的 render 方法
- useSyncExternalStore 触发的更新
- 父组件导致的重新渲染

React 通过渲染对比知道DOM是否需要更改

## 渲染规则

- 渲染必须是纯粹的，并且没有任何副作用
- 

## Fibers

[**在 React Hooks 上实现闭包**](https://www.swyx.io/hooks)