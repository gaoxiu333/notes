# React 渲染执行顺序

## 参考

- [React hooks 执行顺序](https://julesblom.com/writing/react-hook-component-timeline)
- [React 类生命周期方法图](https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/)

## 首次渲染

**局部变量和效果**：

•	在渲染时，所有局部变量会被评估，所有效果会被安排。

•	在初始渲染中，钩子会按照它们的出现顺序进行初始化。

2.	**useState, useReducer 和 useRef**：

•	React 在初始渲染时保存一次初始值，在后续渲染中忽略初始值。

•	**性能优化**：可以通过函数方式提供初始状态，React 在挂载时严格调用一次该函数。

3.	**useMemo**：

•	返回值是调用传递给它的函数的结果。

4.	**useCallback**：

•	在初始渲染中，React 返回传递给它的函数本身（不调用）。

5.	**useDeferredValue**：

•	React 返回与提供的值相同的结果。

`Component called` （组件被调用） → `从上至下初始化钩子` → `返回 JSX` → `提交阶段` → `ref 赋值` → `useLayoutEffect` → `浏览器渲染完成` (用户可见) → `useEffect`

## 重新渲染

`Component called` → `执行依赖变化的 hook` → `返回 JSX` → `提交阶段` → `ref 清除` → `useLayoutEffect 卸载` → `ref 赋值` → `useLayoutEffect` → `浏览器渲染完成` → `useEffect卸载` → `useEffect`

## 组件卸载阶段

`useLayoutEffect 卸载` → `ref 清除` → `Remove DOM nodes` → `useEffect 卸载`

## 递归子组件

- `useLayoutEffect`
    - **执行：**当有子组件时，useLayoutEffect 的调用顺序是从子组件向上到父组件（由下至上）
    - **卸载：**与执行相同，由下至上
- `useEffect` 执行和卸载也都是 **由下至上**