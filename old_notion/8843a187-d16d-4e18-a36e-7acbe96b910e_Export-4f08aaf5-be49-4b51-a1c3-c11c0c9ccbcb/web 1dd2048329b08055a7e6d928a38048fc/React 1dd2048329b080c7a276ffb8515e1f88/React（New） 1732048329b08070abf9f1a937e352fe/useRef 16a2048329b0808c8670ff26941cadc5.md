# useRef

## 定义

useRef 是 React 的一个 Hook，用于创建可变的引用对象，其值在组件生命周期内持久化，不会因组件重新渲染而改变。

**语法**

```tsx
const ref = useRef(initialValue);
```

- `ref.current` 存储当前值或 DOM 节点

## 特点

1. 持久化引用值：跨渲染周期保存值，但不会出发重新渲染
2. DOM 操作： 绑定并访问 DOM 元素
3. 性能优化：避免重复绑定副作用或存储状态外的值

## 常见用途

1. 操作DOM
    - 聚焦、滚动、动画
    
    ```tsx
    const inputRef = useRef(null);
    <input ref={inputRef} />;
    inputRef.current.focus();
    ```
    
2. 存储可变值
    - 防抖、定时器ID、前一个状态值
    
    ```tsx
    const timerRef = useRef(null);
    timerRef.current = setTimeout(...);
    clearTimeout(timerRef.current);
    ```
    
3. 追踪前一个状态
    - 保存上一次的状态值
    
    ```tsx
    const prevCountRef = useRef(count);
    useEffect(() => {
      prevCountRef.current = count;
    });
    ```
    
4. 性能优化
    - 避免重复实践绑定或重复逻辑

## 注意

- 不会触发重新渲染：修改 `ref.current` 不会导致组件更新
- 初始值为 nul 的安全性：检查 `ref.current` 是否为 nul

## 不稳定 Ref 回调

- 每次重新渲染时，回调函数都被重新创建，导致 React 无法记住上次渲染时的回调函数，因为每次都会触发。

**特性**

- 每次渲染时，React 都会调用这个回调函数，先传入 `null` 再传入新的 DOM

```tsx
const MyComponent = () => {
  const refCallback = (node) => {
    console.log(node); // 在每次渲染时都会被调用
  };

  return <div ref={refCallback}>Hello</div>;
};
```

## 稳定 Ref 回调

- 使用 `useCallback` 记住Ref回调函数的引用
- 这样 Ref 只有在 DOM 被创建或者删除时才会被调用。

```tsx
const MyComponent = () => {
  const refCallback = useCallback((node) => {
    console.log(node); // 只有当 DOM 节点发生变化时才会调用
  }, []);

  return <div ref={refCallback}>Hello</div>;
};
```