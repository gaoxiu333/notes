# 问题

scheduler 执行的回调函数都是有 react-reconciler 决定，那么如何确定，每次回调函数的状态，或者参数呢？然后关联这些回调函数和执行结果，这属于什么设计模式？react 提倡纯函数的原因也是因为这个吗？还有为了支持并发模式做出了哪些改变？

- `fiber构造循环`是以`树`为数据结构, 从上至下执行深度优先遍历(详见[react 算法之深度优先遍历](https://7km.top/algorithm/dfs)).

![image.png](%E9%97%AE%E9%A2%98%201912048329b0809ea359cd606d3565b5/image.png)

### **Update 与 UpdateQueue 对象还有hook对象，都蛮像的，一次理解两个队列概念～**

![image.png](%E9%97%AE%E9%A2%98%201912048329b0809ea359cd606d3565b5/image%201.png)

**React 渲染过程主要分为三个阶段： 主要是哪些阶段，每个阶段的开始标志和结束标志**

1.	**Reconciliation 阶段（协调阶段）**：React 比较虚拟 DOM 和真实 DOM，决定哪些部分需要更新。

2.	**Render 阶段（渲染阶段）**：计算更新后的组件树并准备需要更新的 DOM。

3.	**Commit 阶段（提交阶段）**：应用实际的 DOM 更新并执行副作用（例如：useEffect 和 callback 回调）。

![image.png](%E9%97%AE%E9%A2%98%201912048329b0809ea359cd606d3565b5/image%202.png)

从上图可以看出， 所以， react-reconciler 的核心都在 [ReactFiberWorkLoop.js](https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js)中?????????

scheduleUpdateOnFiber → ensureRootIsScheduled → workLoop→performConcurrentWorkOnRoot→renderRootConcurrent→workLoop→performUnitOfWork→beginWork/completeWork→commitRoot

为了加强记忆，给一个间断的生动总结，增加辨识度，让人一眼就能记住每个核心函数的

通过`优先级`的灵活运用, `React`实现了`可中断渲染`,`时间切片(time slicing)`,`异步渲染(suspense)`等特性.

react 的启动过程，梳理的还不顺畅

![image.png](%E9%97%AE%E9%A2%98%201912048329b0809ea359cd606d3565b5/image%203.png)

**这种优先级的选择，该如何消化？好绕**

![image.png](%E9%97%AE%E9%A2%98%201912048329b0809ea359cd606d3565b5/image%204.png)

为什么不解释了！！！！！！！！

**还有深度优先遍历**

很多 比如 workInprogress 到底是个啥，如何深入记忆

- pendingProps
- queue。。。
- fiberRoot
- 还有全局变量吗？
- 可视化一下他们的关系，加深记忆？

除了 图解 react 中的算法，react 源码中还设计到哪些常见的算法和技巧

### 核心工作流程

- Render 阶段（调和阶段）
- Commit 阶段（提交阶段）
- Layout 阶段（布局阶段）
- **ExecutionContext 和任务上下文管理**
    - [变量定义](https://github.com/facebook/react/blob/v18.2.0/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L263-L266)
        - `NoContext`  默认的空上下文，表示 React 未处于任何特殊阶段或模式
        - `BatchedContext` 表示 React 处于**批量更新模式**
        - `RenderContext` 表示 React 正在**协调阶段（Reconciliation/Render Phase）**，即构建新的 Fiber 树（Virtual DOM）
        - `CommitContext` 表示 React 处于**提交阶段（Commit Phase）**，即应用副作用到真实 DOM。

一个 **ExecutionContext 表述不清楚 react 的核心阶段和流程，那么是什么决定了layout阶段，应该还差一个变量，或者是什么在控制呢？**