# 学习工具链

clone

… 尝试了几次，都失败了

React 贡献指南？

[https://julesblom.com/writing](https://julesblom.com/writing)

## 准备工作

1. `clone` react 源码，然后build
2. `create-react-app` 创建 react 项目
3. 使用 `pnpm file:` 协议更换项目的 react 依赖
4. 开始打断电调试

## 工具

- [Visual Studio Code](https://code.visualstudio.com/)
    - 插件
        - [Flow Language Support](https://flow.org/en/docs/editors/vscode/) - 消除代码报错
        - 配置 vscode，添加如下：
        
        ```jsx
        {
          "javascript.validate.enable": false,
          "flow.useNPMPackagedFlow": true
        }
        ```
        

### 阅读源码

需要 vsCode 的flowjs插件

## 断点

- `debugger`
- DOM 断点
    - `subtree modifications`

## 调试 build 后的文件

很简单，使用推荐的默认配置接口，注意端口号为项目启动的端口号

```bash
{
    // 使用 IntelliSense 了解相关属性。 
    // 悬停以查看现有属性的描述。
    // 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        {
            "type": "chrome",
            "request": "launch",
            "name": "针对 localhost 启动 Chrome",
            "url": "http://localhost:3001",
            "webRoot": "${workspaceFolder}",
            "sourceMaps":true,
            "trace": true
        }
    ]
}
```

## 调试有 sourcemap 的代码

## React 基本概念

### Trigger

`ReactDOMRoot.render()` | `setState` → `scheduleUpdateOnFiber()` → `ensureRootIsScheduled()`

所有工作都是从这里开始，无论是初始挂在还是重新渲染

### Schedule

它基本上是一个优先级队列

### Render

重新计算 Fiber Tree 并找出需要哪些更新

由于并发渲染，渲染阶段可能会被中断和恢复

### Commit

构建新的Fiber Tree 并导出最小更新，将更新提交到 DOM 上