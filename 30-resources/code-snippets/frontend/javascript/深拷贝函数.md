---
title: æ·±æ‹·è´å‡½æ•°
jd_id: 30.00.1001
created: 2023-10-21 09:30
updated: 2023-10-21 09:30
type: snippet
status: active
language: javascript
schema: v1
tags: [lang/javascript, topic/algorithm, topic/utility]
complexity: 3
reusability: 5
performance: 4
maintainability: 4
tested: true
environment: all
---

# æ·±æ‹·è´å‡½æ•°

## ğŸ“ æ¦‚è¿°

ä¸€ä¸ªå¯ä»¥æ·±åº¦å¤åˆ¶JavaScriptå¯¹è±¡çš„å‡½æ•°ï¼Œæ”¯æŒå¤„ç†å¾ªç¯å¼•ç”¨ã€ç‰¹æ®Šå¯¹è±¡ç±»å‹ï¼ˆå¦‚Dateã€RegExpã€Mapã€Setç­‰ï¼‰å’Œä¿æŒåŸå‹é“¾ã€‚

## ğŸ§© ä»£ç 

```javascript
/**
 * æ·±æ‹·è´å‡½æ•°ï¼Œç”¨äºåˆ›å»ºå¯¹è±¡çš„å®Œæ•´å‰¯æœ¬
 * @param {*} obj - éœ€è¦æ·±æ‹·è´çš„å¯¹è±¡
 * @param {Map} [visited=new Map()] - ç”¨äºå¤„ç†å¾ªç¯å¼•ç”¨çš„Map
 * @returns {*} è¿”å›æ·±æ‹·è´åçš„å¯¹è±¡
 */
function deepClone(obj, visited = new Map()) {
  // å¤„ç†éå¯¹è±¡ç±»å‹å’Œnull
  if (obj === null || typeof obj !== 'object') {
    return obj;
  }
  
  // å¤„ç†å¾ªç¯å¼•ç”¨
  if (visited.has(obj)) {
    return visited.get(obj);
  }
  
  // å¤„ç†ç‰¹æ®Šå¯¹è±¡ç±»å‹
  if (obj instanceof Date) {
    return new Date(obj);
  }
  
  if (obj instanceof RegExp) {
    return new RegExp(obj.source, obj.flags);
  }
  
  if (obj instanceof Map) {
    const mapResult = new Map();
    visited.set(obj, mapResult);
    obj.forEach((value, key) => {
      mapResult.set(
        deepClone(key, visited),
        deepClone(value, visited)
      );
    });
    return mapResult;
  }
  
  if (obj instanceof Set) {
    const setResult = new Set();
    visited.set(obj, setResult);
    obj.forEach(value => {
      setResult.add(deepClone(value, visited));
    });
    return setResult;
  }
  
  if (obj instanceof Array) {
    const arrResult = [];
    visited.set(obj, arrResult);
    obj.forEach((value, index) => {
      arrResult[index] = deepClone(value, visited);
    });
    return arrResult;
  }
  
  // å¤„ç†æ™®é€šå¯¹è±¡
  const objResult = Object.create(Object.getPrototypeOf(obj));
  visited.set(obj, objResult);
  
  Object.keys(obj).forEach(key => {
    objResult[key] = deepClone(obj[key], visited);
  });
  
  return objResult;
}
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

```javascript
// ç¤ºä¾‹1: åŸºç¡€å¯¹è±¡æ·±æ‹·è´
const original = {
  name: "æµ‹è¯•å¯¹è±¡",
  info: {
    age: 25,
    skills: ["JavaScript", "Python"]
  }
};

const cloned = deepClone(original);
cloned.info.age = 30;
cloned.info.skills.push("Rust");

console.log(original.info.age); // è¾“å‡º: 25 (åŸå¯¹è±¡æœªå—å½±å“)
console.log(original.info.skills); // è¾“å‡º: ["JavaScript", "Python"] (åŸæ•°ç»„æœªå—å½±å“)

// ç¤ºä¾‹2: å¾ªç¯å¼•ç”¨
const obj = { name: "å¾ªç¯å¼•ç”¨" };
obj.self = obj;
const clonedObj = deepClone(obj);
console.log(clonedObj.self === clonedObj); // è¾“å‡º: true (ä¿æŒäº†å¾ªç¯å¼•ç”¨ç»“æ„)

// ç¤ºä¾‹3: ç‰¹æ®Šå¯¹è±¡ç±»å‹
const special = {
  date: new Date(),
  regex: /test/g,
  map: new Map([["key", "value"]]),
  set: new Set([1, 2, 3])
};

const clonedSpecial = deepClone(special);
console.log(clonedSpecial.date instanceof Date); // è¾“å‡º: true
console.log(clonedSpecial.regex instanceof RegExp); // è¾“å‡º: true
console.log(clonedSpecial.map instanceof Map); // è¾“å‡º: true
console.log(clonedSpecial.set instanceof Set); // è¾“å‡º: true
```

## ğŸ“Š å‚æ•°è¯´æ˜

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | å¿…å¡« | æè¿° |
|-------|------|-------|------|------|
| obj | any | - | âœ… | éœ€è¦æ·±æ‹·è´çš„å¯¹è±¡ |
| visited | Map | new Map() | âŒ | ç”¨äºå¤„ç†å¾ªç¯å¼•ç”¨çš„Mapï¼Œä¾›å†…éƒ¨é€’å½’ä½¿ç”¨ |

## ğŸ“‹ è¿”å›å€¼

| ç±»å‹ | æè¿° |
|------|------|
| any | è¿”å›æ·±æ‹·è´åçš„å¯¹è±¡ï¼Œä¸åŸå¯¹è±¡ç»“æ„ç›¸åŒä½†å®Œå…¨ç‹¬ç«‹ |

## âš ï¸ æ³¨æ„äº‹é¡¹

- ä¸æ”¯æŒå…‹éš†å‡½æ•°ï¼Œå‡½æ•°ä¼šè¢«ç›´æ¥å¼•ç”¨
- ä¸ä¿ç•™ä¸å¯æšä¸¾çš„å±æ€§
- å¯¹äºSymbolç±»å‹çš„é”®ï¼Œå½“å‰ç‰ˆæœ¬ä¸ä¼šå¤„ç†
- æ€§èƒ½è€ƒè™‘ï¼šæ·±æ‹·è´å¤§å‹å¯¹è±¡å¯èƒ½ä¼šå½±å“æ€§èƒ½
- é’ˆå¯¹DOMèŠ‚ç‚¹ã€WebSocketç­‰ç‰¹æ®Šå¯¹è±¡ç±»å‹ï¼Œå‡½æ•°ä¸ä¼šå¤„ç†ï¼Œä¼šç›´æ¥è¿”å›å¼•ç”¨

## ğŸ” å·¥ä½œåŸç†

æ­¤å‡½æ•°é€šè¿‡é€’å½’éå†å¯¹è±¡å±æ€§å®ç°æ·±æ‹·è´ï¼ŒåŒæ—¶ä½¿ç”¨Mapæ¥è¿½è¸ªå·²è®¿é—®å¯¹è±¡ï¼Œä»¥å¤„ç†å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚å¯¹äºç‰¹æ®Šå¯¹è±¡ç±»å‹ï¼ˆå¦‚Dateã€RegExpç­‰ï¼‰ï¼Œä¼šä½¿ç”¨å¯¹åº”çš„æ„é€ å‡½æ•°åˆ›å»ºæ–°å®ä¾‹ã€‚ä½¿ç”¨Object.createä¿æŒåŸå‹é“¾ï¼Œç¡®ä¿å…‹éš†å¯¹è±¡å…·æœ‰ä¸åŸå§‹å¯¹è±¡ç›¸åŒçš„åŸå‹ã€‚

## ğŸ”„ æ›¿ä»£æ–¹æ¡ˆ

- JSONåºåˆ—åŒ–ï¼š`JSON.parse(JSON.stringify(obj))`ï¼ˆç®€å•ä½†æœ‰é™åˆ¶ï¼‰
- ç¬¬ä¸‰æ–¹åº“ï¼š
  - Lodashçš„_.cloneDeep()
  - structuredCloneï¼ˆç°ä»£æµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼‰
  - Immeråº“ï¼ˆæ¨èç”¨äºä¸å¯å˜æ•°æ®ï¼‰

## ğŸ“š ç›¸å…³ä»£ç ç‰‡æ®µ

- [[æµ…æ‹·è´å‡½æ•°]]
- [[å¯¹è±¡åˆå¹¶å·¥å…·å‡½æ•°]]

## ğŸ”— ç›¸å…³æ¦‚å¿µ

- [[JavaScriptå¼•ç”¨ç±»å‹å’Œå€¼ç±»å‹]]
- [[JavaScriptåŸå‹é“¾]]

## ğŸ“– å‚è€ƒèµ„æ–™

- [MDN Web Docs - Object.create()](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create)
- [MDN Web Docs - ä½¿ç”¨ structuredClone è¿›è¡Œæ·±æ‹·è´](https://developer.mozilla.org/zh-CN/docs/Web/API/structuredClone)
- [æ·±å…¥JavaScriptå¯¹è±¡æ‹·è´](https://juejin.cn/post/6844903929705136141)

## ğŸ“ ä½¿ç”¨æƒ…å¢ƒ

- éœ€è¦å¤åˆ¶å¤æ‚å¯¹è±¡ä¸”ä¸å½±å“åŸå§‹å¯¹è±¡æ—¶
- ç¼–å†™åŸºäºä¸å¯å˜æ•°æ®çš„åº”ç”¨ï¼Œå¦‚Reduxä¸­çš„çŠ¶æ€æ›´æ–°
- ç¼“å­˜è®¡ç®—ç»“æœæ—¶éœ€è¦å­˜å‚¨æºå¯¹è±¡çš„å‰¯æœ¬
- éœ€è¦å¤‡ä»½å¤æ‚æ•°æ®ç»“æ„æ—¶

## ğŸ·ï¸ ä¿®æ”¹å†å²

- 2023-10-21 - åˆ›å»ºåˆå§‹ç‰ˆæœ¬ 