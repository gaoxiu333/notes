---
title: 依赖管理指南
jd_id: J10-20250528-1401
created: 2025-05-28 14:01
updated: 2025-05-28 14:01
type: guide
status: active
tags: [topic/dependency, topic/pnpm, topic/management, action/guide]
---

# 📦 依赖管理指南

## 工具介绍

- knip - 检测未使用的包或文件
- syncpack - 统一依赖管理

**添加/删除/更新依赖：**

- **针对特定应用或包：**

```bash
# 进入特定包目录
cd apps/nextjs-app
pnpm add <package-name>
# 或者在根目录使用 --filter
pnpm add <package-name> --filter nextjs-app
```

**针对根工作区（主要用于开发工具）：**

```
pnpm add <package-name> -D -w # -w 或 --workspace-root
pnpm add "@repo/eslint-config@workspace:*" --filter react-vite
```

**升级依赖：**

```
pnpm up -r <package-name> # 升级所有包中的 <package-name>
pnpm up -r --latest       # 升级所有包中的所有依赖到最新版本（谨慎操作）
```

- **保持版本一致性：**
    
    - **定期运行 `syncpack lint` 和 `syncpack fix`** 来检查和自动修复不同包之间相同依赖的版本不一致问题。
    - 对于非常核心的库（如 React, Next.js），如果遇到难以解决的传递依赖版本冲突，可以考虑在根 `package.json` 的 `pnpm.overrides` 字段中强制指定版本。
- **处理内部包依赖：**
    
    - 当 `apps/nextjs-app` 需要使用 `packages/ui` 中的组件时，由于 `link-workspace-packages=true` 和 `save-workspace-protocol=true` 的配置，pnpm 会自动处理本地链接。直接在 `nextjs-app/package.json` 中添加 `"@repo/ui": "workspace:*"` 即可。
- **代码风格和质量检查：**
    
    - `lint` 和 `check-types` 脚本通过 Turborepo 在所有相关包中执行。
    - Husky `pre-commit` 钩子确保提交前代码符合 lint 规范。
- **环境管理：**
    
    - 根目录的 `.nvmrc` 文件（内容为 `lts/jod`，这可能是一个特定的LTS版本代号或用户自定义的别名）建议使用 NVM (Node Version Manager) 来管理 Node.js 版本，以保证开发环境的一致性。
    - 根 `package.json` 中的 `"engines": { "node": ">=18" }` 与 `.npmrc` 中的 `engine-strict=true` 配合，强制要求使用符合条件的 Node.js 版本