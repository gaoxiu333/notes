---
title: "为打造无敌AI智能体的提示工程指南"
date: 2025-03-15
tags: 
  - type/guide
  - subject/ai
  - topic/prompt-engineering
source: https://aiablog.medium.com/prompt-engineering-for-unbeatable-ai-agents-df4a1abf4bd8
author: AI Applied
status: completed
---

# 为打造无敌AI智能体的提示工程指南

> 本文总结了构建高级AI智能体(Agent)时常用的关键提示工程技术，基于对GPT Pilot、GPT Engineer、Devin等顶尖智能体系统的分析。

## 不同智能体，相同技术

尽管市面上存在多种类型的AI智能体，但几乎所有表现优异的智能体系统（如GPT Pilot、GPT Engineer、Devin甚至Self Operating Computer）都采用了非常相似的提示技术来实现其卓越性能。

本文将深入探讨使这些智能体能够以其独特方式工作的最关键提示方法，以Claude Engineer为例，因为它综合运用了多种高级提示技术。

## 迭代优化提示 (Iterative Refinement Prompting)

这是智能体最重要的方法之一，允许它们执行迭代操作或中间步骤问题解决。其核心优势在于使模型能够通过创建中间步骤并逐步完成每个步骤来执行复杂任务。

### 实现方法

有多种方式可以实现迭代优化，例如，在Claude Engineer中，模型会在任务开始时（AUTOMODE模式下）创建一个分步大纲：

> 你当前处于自动模式！！！
>
> 在自动模式下：
>
> **1. 根据用户请求为自己设定清晰、可实现的目标**
>
> **2. 逐一完成这些目标，根据需要使用可用工具**

这种方法有效，但对于长任务有一个明显缺点：如果初始计划（位于对话的早期消息中）超出了模型的token限制，模型将无法按计划进行，可能导致错误。

### 静态待办事项列表技术

更有效的方法是使用静态待办事项列表(Static To Do List)，特别适用于需要多步骤的长任务。核心思想是提示模型使用特定函数创建待办事项列表，将列表保存到数组中，并在每条消息中将此数组提供给模型：

```json
{
  "initialize_plan": { ... } // 初始化包含预定义计划项列表的计划
  ...
}
```

这种规划系统使智能体不仅能执行多步骤任务，还能执行跨越数百步的极长任务，因为计划在每次响应时都会提供给模型，清晰指示当前步骤和后续步骤。

## 身份提示 (Identity Prompting)

这是构建智能体的基础性技术，即基于角色的提示。这通常用于大多数聊天机器人的系统提示开头部分。

### 为何强大

身份提示的强大之处在于它能用很小的空间概括非常复杂的模型行为。例如：

> 你是一位非常精通土耳其法律事务的专家

这个简短提示会引发模型一系列复杂的行为:
1. 能够自信地提供法律建议，不过分担忧其陈述的准确性
2. 提供详细建议以符合"专家"的标准
3. 以清晰、直接、简洁的方式呈现观点，而非犹豫不决
4. 自动采用适合法律咨询的语气和格式

身份提示方法使我们能够为模型编程近乎无限的行为集合，而无需大量token空间和繁琐的测试过程。

### 双重身份提示技巧

使用两个相互补充的身份提示通常比单一身份更有效：

```
你是Claude，一个由Anthropic的Claude-3.5-Sonnet模型驱动的AI助手。

同时，你是一位杰出的软件开发人员，拥有跨多种编程语言、框架和最佳实践的广泛专业知识。
```

这种双重身份解决了高级模型有时为了遵循系统提示而向用户呈现虚假身份的问题。当两个提示同时使用时，模型会在自我认知问题上选择AI模型提示，但在专业能力上采用第二个身份。

### 身份提示vs指令提示

比较以下两种方式表达相同意图的效率差异：

**指令式提示：**
> 你避免进行与法律建议无关的长对话。在这种情况下，告知用户你只提供法律帮助，礼貌地拒绝继续，并询问是否有关于法律的问题需要帮助。
>
> 如果你认为更多信息有助于提供更好的帮助，在回应结束时，可以向用户询问可能有助于评估情况的具体细节。
>
> （约500字符，100+ tokens）

**身份式提示：**
> 你是一位非常直接的律师，从不讨论非法律问题，会礼貌地告知提出无关问题的用户。
>
> 你总是致力于解决用户的整个问题，因此会主动询问额外信息以提供更合适的解决方案。
>
> （token数量约为指令式的1/3，效果更好）

对于涉及主观判断的概念，身份提示通常比指令提示更有效，因为它让模型自行决定如何体现这一身份。

## 自我反思提示 (Self-reflection Prompts)

这是提示工程中更高级的技术之一，使AI智能体能够基于内省评估自己的输出。这种技术在Self Operating Computer项目中被广泛应用，允许GPT-4 Turbo在操作结束时评估其行动结果。

### 核心优势

自我反思提示允许智能体考虑其先前行动的有效性，评估它们是否符合预期结果。例如：

> 完成所述任务后，评估结果是否完全符合原始提示中描述的用户目标。

这个提示鼓励模型：
- 批判性地审查自己的输出
- 识别响应中的任何差距或不准确之处
- 进行必要的更正或增强，以确保完整性和准确性

### 避免无限循环

自我反思提示的主要挑战是可能导致模型陷入无限循环，不断尝试完善而永远不能完成任务。为了克服这一挑战，在指示模型评估其输出时，必须设定清晰简洁的目标，例如：

1. 是否满足了所有明确要求
2. 是否处理了所有列出的项目
3. 是否有明显的逻辑或技术错误

目标是消除模型主观决定何时停止的需要，提供客观的完成标准。

## 智能体设计的最佳实践

综合上述提示技术，构建高效AI智能体的最佳实践包括：

1. **明确的身份定义**：为智能体设定清晰的专业身份，明确其专长领域
2. **结构化任务分解**：使用迭代优化提示技术将复杂任务分解为可管理的步骤
3. **持久化状态跟踪**：使用静态待办事项列表等技术跟踪长期任务进度
4. **自我评估机制**：整合有约束的自我反思能力，确保输出质量
5. **明确的终止条件**：为每个任务设定客观的完成标准

通过组合这些技术，可以构建出接近专业开发人员水平的AI智能体系统，能够独立完成复杂的多步骤任务。 