---
title: "使用AI提高代码质量"
date: 2025-01-15
tags: 
  - type/guide
  - subject/coding
  - tool/ai
source: https://minimaxir.com/2025/01/write-better-code/
author: Max Woolf
status: completed
---

# 使用AI提高代码质量

> 本文是Max Woolf的"Write Better Code"一文的摘要，探讨了如何通过简单的AI提示迭代来改进代码质量和性能。

## "让它更好"实验

2023年11月，在OpenAI添加了ChatGPT通过DALL-E 3生成图像的功能后，出现了一个短暂的趋势，用户给AI一个基础图像，然后不断要求模型"让它更X"，其中X可以是任何东西。这个趋势启发了作者思考：如果对代码采用类似的技术会发生什么？

如果仅仅通过要求AI"让代码更好"这样简单的提示，就能真正改进代码，那将是生产力的巨大提升。作者决定进行实验，看看通过这种方式能否有效提高代码质量和性能。

## 实验设置

作者使用Claude 3.5 Sonnet，给它一个面试风格的Python编码问题：

> 编写Python代码解决此问题：
> 
> 给定一个包含100万个介于1到100,000之间的随机整数的列表，找出数字之和为30的最小和最大数字之间的差值。

初始代码实现是正确的，但存在明显的优化空间。作者在M3 Pro Macbook Pro上测试，发现初始代码平均需要**657毫秒**运行。

## 迭代改进

### 迭代#1："编写更好的代码"

仅仅使用"编写更好的代码"作为提示，Claude生成了一个优化版本：
- 将代码重构为一个Python类，采用面向对象方法
- 使用整数运算而非类型转换计算数字和
- 预先计算所有可能的数字和并存储在数组中

这些优化使代码相对于初始实现速度提高了**2.7倍**。

### 迭代#2："编写更好的代码"

再次使用相同提示，Claude添加了更高级的优化：
- 使用Python的concurrent-futures包实现多线程处理
- 采用向量化的numpy操作，比基础Python操作快得多
- 实现了计算数字和的向量化实现

修复一些并行化问题后，代码比基础实现快**5.1倍**。

### 迭代#3："编写更好的代码"

第三次迭代添加了更多结构但算法效率有所下降，性能比基础实现快**4.1倍**。

### 后续迭代

在后续迭代中，Claude继续添加更多功能，包括：
- 更复杂的缓存机制
- 使用Numba进行JIT编译
- 实现对算法参数的自动调优
- 添加全面的测试和基准测试框架
- 集成了日志记录、性能分析和命令行界面

## 主要发现

1. **简单提示可以带来真正的改进**：仅使用"编写更好的代码"这样的简单提示，代码性能提高了5倍以上。

2. **收益递减**：初始几次迭代带来最大的性能改进，之后的迭代开始专注于代码结构和可维护性。

3. **代码复杂性增长**：随着迭代，代码变得越来越复杂和抽象，从简单的函数发展为多类、多模块的系统。

4. **代码风格一致性**：尽管代码变得更复杂，AI保持了一致的命名约定和代码组织。

## 实用建议

1. **初步草稿后寻求改进**：先让AI生成初始代码，然后要求它改进，而不是一开始就要求完美代码。

2. **关注特定改进**：可以针对性地要求AI提高代码的某些方面，如性能、可读性或健壮性。

3. **在复杂性和实用性之间平衡**：后期迭代的代码虽然更"先进"，但可能过于复杂，不适合实际项目。

4. **审查和理解**：不要盲目接受AI的改进，要理解这些更改是如何和为什么有效。

## 总结

简单的"让代码更好"提示可以让AI显著改进代码，尤其是在性能方面。然而，这种方法最适合作为提高代码质量的起点，而不是终点。开发人员仍需权衡代码复杂性和实用性，并确保理解AI引入的更改。

随着AI编码助手变得越来越强大，这种迭代改进的方法可能成为软件开发的重要辅助工具，帮助开发人员更快地达到更高质量的代码。 